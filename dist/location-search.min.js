!function(n){"use strict";n.module("locationSearch",[]).directive("locationSearch",["$timeout","$location","$window","$parse",function(i,e,t,o){return{restrict:"A",require:["?ngModel","?^form"],link:function(a,c,r,l){function u(n){return n.replace(/\/$/,"")}function f(o){if(o){var c={},l=a.$eval(r.locationSearchReset),f=t.location.hash.replace(e.url(),""),h=u(t.location.href.replace(t.location.hash,""));try{var S=n.fromJson(o);o=S}catch(n){}n.forEach(s,function(i,e){var t=null;n.isObject(o)&&n.isDefined(o[i])?t=o[i]:n.isString(o)&&(t=o),c[i]=""!==t?t:null});var d=e.search();if(l||(c=n.extend({},d,c)),i(function(){e.search(c)}),r.locationSearchUrl&&n.isString(r.locationSearchUrl)){var $=u(r.locationSearchUrl);if($!==h){var g=$+"/"+u(f)+e.url();i(function(){e.search({}).replace()}),t.location.href=g}}}}var s=a.$eval(r.locationSearch);s=n.isArray(s)?s:[r.locationSearch];var h=l[0],S=l[1];if(r.locationSearch&&(h||S)){var d=null,$=function(i){d=s.length>1?{}:null,n.forEach(s,function(e,t){n.isObject(d)?d[e]=n.isDefined(i[e])?i[e]:null:n.isDefined(i[e])&&(d=i[e])}),n.isObject(d)&&(d=n.toJson(d)),(0,o(r.ngModel).assign)(a,d)},g=function(i){var e=a.$eval(r.ngSubmit);!e&&n.isObject(e)||(n.isUndefined(a[r.ngSubmit])&&(a[r.ngSubmit]={}),n.forEach(s,function(e,t){n.isDefined(i[e])&&(a[r.ngSubmit][e]=i[e])}))};h&&(a.$watch(function(){return h.$modelValue},function(n,i){n!==i&&f(n)}),a.$on("$locationChangeStart",function(n,i,t,o,a){$(e.search())}),$(e.search())),S&&(c.on("submit",function(){var n=a.$eval(r.ngSubmit);n&&f(n)}),a.$on("$locationChangeStart",function(n,i,t,o,a){g(e.search())}),g(e.search()))}a.$on("$destroy",function(){n.isDefined(a[r.ngSubmit])&&delete a[r.ngSubmit]})}}}])}(window.angular);