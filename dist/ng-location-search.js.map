{"version":3,"sources":["ng-location-search.js"],"names":["angular","module","directive","$log","$timeout","$location","$window","$parse","$httpParamSerializer","restrict","require","link","scope","elem","attrs","Ctrl","search_keys","modelCtrl","formCtrl","trailling_slash","url","isString","replace","parseLocationSearch","value","new_search","reset_search","$eval","ngLocationSearchReset","location_href","ngLocationSearchUrl","abs_url","location","href","hash","is_add_to_url","indexOf","is_internal_url","is_abs_url","protocol","value_object","fromJson","err","forEach","key","val","search_val","isObject","isDefined","current_search","search","extend","path_url","path","hash_url","param_url","new_href","$$html5","$apply","debug","ngLocationSearch","isArray","changeModel","loc_search","length","toJson","getter","ngModel","setter","assign","changeForm","fields","ngSubmit","isUndefined","$watch","$modelValue","newVal","oldVal","$on","event","newUrl","oldUrl","newState","oldState","on","submit","handleDestroyEvent","window"],"mappings":"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","file":"ng-location-search.js","sourcesContent":["(function(angular){\n    'use strict';\n\n    angular.module('ngLocationSearch', []).directive('ngLocationSearch', ['$log', '$timeout', '$location', '$window', '$parse', '$httpParamSerializer', function ($log, $timeout, $location, $window, $parse, $httpParamSerializer) {\n        return {\n            restrict: \"A\",\n            require: ['?ngModel', '?^form'],\n            link: function (scope, elem, attrs, Ctrl) {\n\n                var search_keys;\n\n                /**\n                 * Set the controllers for model and form\n                 */\n                var modelCtrl = Ctrl[0];\n                var formCtrl = Ctrl[1];\n\n\n                /**\n                 * Trailling Slash Url\n                 *\n                 * @param url\n                 */\n                function trailling_slash (url) {\n\n                    if ( angular.isString(url) ) {\n                        return url.replace(/\\/$/, '');\n                    }\n\n                    return false;\n                }\n\n\n                /**\n                 * Parse value for set the location search.\n                 *\n                 * @param value\n                 */\n                function parseLocationSearch(value) {\n\n                    var new_search = {};\n                    var reset_search = scope.$eval(attrs.ngLocationSearchReset);\n                    var location_href = trailling_slash(attrs.ngLocationSearchUrl);\n                    var abs_url = trailling_slash($window.location.href.replace($window.location.hash, ''));\n\n                    var is_add_to_url = location_href.indexOf('/') === 0;\n                    var is_internal_url = location_href.indexOf('#!/') !== -1 || location_href.indexOf('#/') !== -1;\n                    var is_abs_url = location_href.indexOf($location.protocol()) === 0;\n\n                    //Deserializes a JSON search string.\n                    try {\n                        var value_object = angular.fromJson(value);\n\n                        value = value_object;\n                    }\n                    catch(err) {\n\n                    }\n\n                    //Apply key val on location search.\n                    angular.forEach(search_keys, function (key, val) {\n                        var search_val = null;\n\n                        if (angular.isObject(value) && angular.isDefined(value[key]) ) {\n                            search_val = value[key];\n                        }\n                        else if (angular.isString(value)) {\n                            search_val = value;\n                        }\n\n                        new_search[key] = search_val !== '' ? search_val : null;\n                    });\n\n                    var current_search = $location.search();\n\n                    if (!reset_search) {\n                        new_search = angular.extend({}, current_search, new_search);\n                    }\n\n                    //Redirect to search url\n                    if (angular.isString(location_href) && location_href !== abs_url) {\n\n                        var path_url = $location.path();\n                        var hash_url = trailling_slash($window.location.hash.replace($location.url(), ''));\n                        var param_url = $httpParamSerializer(new_search);\n\n                        var new_href = '';\n\n                        if (!$location.$$html5 || is_abs_url) {\n\n                            path_url = path_url ? '/' : '';\n                            param_url = param_url ? '?' + param_url : '';\n                            new_href = location_href + param_url;\n\n                            if (!is_internal_url && is_abs_url) {\n                                new_href = location_href + '/' + hash_url + path_url + param_url ;\n                            }\n\n                            $window.location.href = new_href;\n                        }\n                        else {\n\n                            $location.search(param_url);\n                            scope.$apply();\n\n                            if (is_add_to_url) {\n                                new_href = location_href;\n                            }\n                            else {\n                                new_href = path_url + '/' + location_href;\n                            }\n\n                            $location.path(new_href);\n                            scope.$apply();\n                        }\n\n                        $log.debug(new_href);\n                    }\n                    else {\n                        $timeout(function() {\n                            $location.search(new_search);\n                        });\n                    }\n                }\n\n                //Use the current model scope.\n                //Only if attribute is set\n                if (attrs.ngLocationSearch && (modelCtrl || formCtrl)) {\n\n                    search_keys = scope.$eval(attrs.ngLocationSearch);\n                    search_keys = angular.isArray(search_keys) ? search_keys : [attrs.ngLocationSearch];\n                    var search = null;\n\n                    //Set the model change from location search object.\n                    var changeModel = function (loc_search) {\n                        search = (search_keys.length > 1) ? {} : null;\n\n                        //Find in url search params\n                        angular.forEach(search_keys, function (key, val) {\n\n                            if (angular.isObject(search)) {\n                                search[key] = angular.isDefined(loc_search[key]) ? loc_search[key] : null;\n                            }\n                            else if (angular.isDefined(loc_search[key])) {\n                                search = loc_search[key];\n                            }\n                        });\n\n                        //transform selected search to string\n                        if (angular.isObject(search)) {\n                            search = angular.toJson(search);\n                        }\n\n                        //Set default model value.\n                        var getter = $parse(attrs.ngModel);\n                        var setter = getter.assign;\n                        setter(scope, search);\n                    };\n\n\n\n                    //Set the model change from location search object.\n                    var changeForm = function (loc_search) {\n                        var fields = scope.$eval(attrs.ngSubmit);\n\n                        if (!fields && angular.isObject(fields)) {\n                            return;\n                        }\n\n                        if ( angular.isUndefined(scope[attrs.ngSubmit]) ) {\n                            scope[attrs.ngSubmit] = {};\n                        }\n\n                        //Find in url search params\n                        angular.forEach(search_keys, function (key, val) {\n\n                            if (angular.isDefined(loc_search[key])) {\n\n                                //Set default form value.\n                                scope[attrs.ngSubmit][key] = loc_search[key];\n                            }\n                        });\n                    };\n\n\n                    /**\n                     * Evaluate location search attribute if is ngModel\n                     */\n                    if ( modelCtrl ) {\n\n                        //Watch model change\n                        scope.$watch(function () {\n                                return modelCtrl.$modelValue;\n                            },\n                            function (newVal, oldVal) {\n\n                                if (newVal !== oldVal) {\n\n                                    parseLocationSearch(newVal);\n                                }\n                            }\n                        );\n\n                        //Change Model on location change start\n                        scope.$on('$locationChangeStart', function(event, newUrl, oldUrl, newState, oldState) {\n\n                            changeModel($location.search());\n                        });\n\n                        //Init Model\n                        changeModel($location.search());\n                    }\n\n\n                    /**\n                     * Evaluate location search attribute if is form\n                     */\n                    if (formCtrl) {\n\n                        //Event Submit Form\n                        elem.on('submit', function() {\n                            var submit = scope.$eval(attrs.ngSubmit);\n\n                            if (submit) {\n                                parseLocationSearch(submit);\n                            }\n                        });\n\n                        //Change Form on location change start\n                        scope.$on('$locationChangeStart', function(event, newUrl, oldUrl, newState, oldState) {\n\n                            changeForm($location.search());\n                        });\n\n                        //Init Form\n                        changeForm($location.search());\n                    }\n\n                }\n\n                /**\n                 * Destroy\n                 */\n                scope.$on('$destroy', function handleDestroyEvent() {\n                        if ( angular.isDefined(scope[attrs.ngSubmit]) ) {\n                            delete scope[attrs.ngSubmit];\n                        }\n                    }\n                );\n            }\n\n        };\n    }]);\n\n})(window.angular);\n"],"sourceRoot":"dist"}