!function(D){"use strict";D.module("ngLocationSearch",[]).directive("ngLocationSearch",["$rootScope","$log","$timeout","$location","$window","$parse","$httpParamSerializer",function(v,n,m,p,L,b,y){return{restrict:"A",require:["?ngModel","?^form"],link:function(g,n,i,e){function $(n){return!!D.isString(n)&&n.replace(/\/$/,"")}function o(n,e){switch(e){case"array":return D.isArray(n)?n:D.isString(n)&&0<n.length?n.split(","):null;case"number":return D.isNumber(n)?n:parseFloat(n);case"string":return D.isString(n)?n:null;default:return n}}function c(n,e){return e&&D.isObject(n)?n[e]:n}var S,d=i.ngLocationSearchDefault?g.$eval(i.ngLocationSearchDefault):null,r=e[0],a=e[1],t=function(t){var s={},l=g.$eval(i.ngLocationSearchReplace),n=g.$eval(i.ngLocationSearchReset),u=i.ngLocationSearchUrl,h=L.location.href.replace(L.location.hash,""),e=i.ngLocationSearchDelay||0;try{var a=D.fromJson(t);t=a}catch(n){}D.forEach(S,function(n,e){var a=c(d,n);t||(a=null);var r=a;D.isObject(t)&&D.isDefined(t[n])?r=t[n]:D.isString(t)&&(r=t),D.isArray(r)&&(r=r.toString()),s[n]=r&&""!==r?r.toString():""===r?null:a});var f=p.search();n||(s=D.extend({},f,s)),D.equals(s,f)||(v.$broadcast("ngLocationSearchChangeStart",s,f),m(function(){if(D.isString(u)&&u!==h){var n=0!==u.indexOf("/"),e=-1!==u.indexOf("#!/")||-1!==u.indexOf("#/"),a=0===u.indexOf(p.protocol()),r=p.path(),t=$(L.location.hash.replace(p.url(),"")),i=y(s),o="";if(!p.$$html5||a)o=u+(i=i?"?"+i:""),!e&&a&&(r=r&&!p.$$html5?"/":"",o=u+t+r+i),L.location.href=o,p.search(s);else{if(p.search(i),l&&g.$apply(),n){var c=r.split("/");o=c[c.length-1]===u?r:r+"/"+u}else o=u;p.path(o),g.$apply()}}else p.search(s);v.$broadcast("ngLocationSearchChangeSuccess",s,f)},parseInt(e,10)))};if(i.ngLocationSearch&&(r||a)){S=g.$eval(i.ngLocationSearch),S=D.isArray(S)?S:[i.ngLocationSearch];var s,l,u,h=d,f=function(r){var t=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};h=1<S.length?{}:d,D.forEach(S,function(n,e){var a=c(d,n);D.isObject(h)?h[n]=o(D.isDefined(r[n])?r[n]:a,t[n]):h=o(D.isDefined(r[n])?r[n]:a,t[n])}),D.isObject(h)&&(h=D.toJson(h)),(0,b(i.ngModel).assign)(g,h)};if(r&&(g.$watch(function(){return r.$modelValue},function(n,e){if(n!==e&&r.$valid)t(n);else{var a=i.name;v.$broadcast("ngLocationSearchChangeError","model",a,r)}}),g.$on("$locationChangeStart",function(n,e,a,r,t){f(p.search())}),f(p.search())),a)l=function(r){if(0<S.length){var n=g.$eval(i.ngSubmit),t=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};h={$resetForm:void 0,$submitForm:u},D.forEach(S,function(n,e){var a=c(d,n);h[n]=o(D.isDefined(r[n])?r[n]:a,t[n]),D.isDefined(r[n])&&(h.$resetForm=s)}),n=D.isObject(n)?n:{},h=D.extend(n,h),(0,b(i.ngSubmit).assign)(g,h)}},u=function(n){var e=g.$eval(i.ngSubmit),a=i.name,r=g.$eval(a);return D.isUndefined(n)&&(n=e),!D.isDefined(n)||r&&!r.$valid?v.$broadcast("ngLocationSearchChangeError","form",a,r):t(n),e},s=function(){u(null)},n.on("submit",function(){u()}),g.$on("$locationChangeStart",function(n,e,a,r,t){l(p.search())}),l(p.search())}g.$on("$destroy",function(){D.isDefined(g[i.ngSubmit])&&delete g[i.ngSubmit]})}}}])}(window.angular);