!function(O){"use strict";O.module("ngLocationSearch",[]).directive("ngLocationSearch",["$rootScope","$log","$timeout","$location","$window","$parse","$httpParamSerializer",function(m,n,p,L,b,y,D){return{restrict:"A",require:["?ngModel","?^form"],link:function(g,n,i,e){function $(n){return!!O.isString(n)&&n.replace(/\/$/,"")}function o(n,e){switch(e){case"array":return O.isArray(n)?n:O.isString(n)&&0<n.length?n.split(","):null;case"number":return O.isNumber(n)?n:parseFloat(n);case"string":return O.isString(n)?n:null;default:return n}}function c(n,e){return e&&O.isObject(n)?n[e]:n}var S,d=i.ngLocationSearchDefault?g.$eval(i.ngLocationSearchDefault):null,t=e[0],a=e[1],r=function(r){var s={},l=g.$eval(i.ngLocationSearchReplace),n=g.$eval(i.ngLocationSearchReset),u=i.ngLocationSearchUrl,h=b.location.href.replace(b.location.hash,""),e=i.ngLocationSearchDelay||0;try{var a=O.fromJson(r);r=a}catch(n){}O.forEach(S,function(n,e){var a=c(d,n);r||(a=null);var t=a;O.isObject(r)&&O.isDefined(r[n])?t=r[n]:O.isString(r)&&(t=r),O.isArray(t)&&(t=t.toString()),s[n]=t&&""!==t?t.toString():""===t?null:a});var f=L.search();n||(s=O.extend({},f,s)),O.equals(s,f)||(m.$broadcast("ngLocationSearchChangeStart",s,f),p(function(){if(O.isString(u)&&u!==h){var n=0!==u.indexOf("/"),e=-1!==u.indexOf("#!/")||-1!==u.indexOf("#/"),a=0===u.indexOf(L.protocol()),t=L.path(),r=$(b.location.hash.replace(L.url(),"")),i=D(s),o="";if(!L.$$html5||a)o=u+(i=i?"?"+i:""),!e&&a&&(t=t&&!L.$$html5?"/":"",o=u+r+t+i),b.location.href=o,L.search(s);else{if(L.search(i),l&&g.$apply(),n){var c=t.split("/");o=c[c.length-1]===u?t:t+"/"+u}else o=u;L.path(o),g.$apply()}}else L.search(s);m.$broadcast("ngLocationSearchChangeSuccess",s,f)},parseInt(e,10)))};if(i.ngLocationSearch&&(t||a)){S=g.$eval(i.ngLocationSearch),S=O.isArray(S)?S:[i.ngLocationSearch];var s,l,u,h,f=d,v=function(t){var r=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};f=1<S.length?{}:d,O.forEach(S,function(n,e){var a=c(d,n);O.isObject(f)?f[n]=o(O.isDefined(t[n])?t[n]:a,r[n]):f=o(O.isDefined(t[n])?t[n]:a,r[n])}),O.isObject(f)&&(f=O.toJson(f)),(0,y(i.ngModel).assign)(g,f)};if(t&&(g.$watch(function(){return t.$modelValue},function(n,e){if(n!==e&&t.$valid)r(n);else{var a=i.name;m.$broadcast("ngLocationSearchChangeError","model",a,t)}}),g.$on("$locationChangeStart",function(n,e,a,t,r){v(L.search())}),v(L.search())),a)l=function(t){if(0<S.length){var n=g.$eval(i.ngSubmit),r=i.ngLocationSearchTypes?g.$eval(i.ngLocationSearchTypes):{};f={$resetForm:void 0,$submitForm:u},O.forEach(S,function(n,e){var a=c(d,n);f[n]=o(O.isDefined(t[n])?t[n]:a,r[n]),O.isDefined(t[n])&&(f.$resetForm=s)}),n=O.isObject(n)?n:{},f=O.extend(n,f),(0,y(i.ngSubmit).assign)(g,f)}},h=function(n){var e=g.$eval(i.ngSubmit),a=i.name,t=g.$eval(a);return O.isUndefined(n)&&(n=e),!O.isDefined(n)||t&&!t.$valid?m.$broadcast("ngLocationSearchChangeError","form",a,t):r(n),e},u=function(n,e){n?p(function(){h(e)},parseInt(n,10)):h(e)},s=function(){h(null)},n.on("submit",function(){h()}),g.$on("$locationChangeStart",function(n,e,a,t,r){l(L.search())}),l(L.search())}g.$on("$destroy",function(){O.isDefined(g[i.ngSubmit])&&delete g[i.ngSubmit]})}}}])}(window.angular);